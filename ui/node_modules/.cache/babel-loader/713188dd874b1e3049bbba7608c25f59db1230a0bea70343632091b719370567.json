{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Admin\\\\OneDrive\\\\Desktop\\\\Princeton\\\\src\\\\pages\\\\TripChat.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { getTripsFromLocalStorage } from '../utils/tripUtils';\nimport './TripChat.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst TripChat = () => {\n  _s();\n  const {\n    tripId\n  } = useParams();\n  const navigate = useNavigate();\n  const [messages, setMessages] = useState([]);\n  const [inputMessage, setInputMessage] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const [tripInfo, setTripInfo] = useState(null);\n  const [sharedUsers, setSharedUsers] = useState([]);\n  const [showInviteModal, setShowInviteModal] = useState(false);\n  const [inviteEmail, setInviteEmail] = useState('');\n  const messagesEndRef = useRef(null);\n  const inputRef = useRef(null);\n  const API_ENDPOINT = process.env.REACT_APP_API_URL || 'http://localhost:8000/api/trip-planner';\n\n  // Fetch trip info and generate initial plan\n  useEffect(() => {\n    let isMounted = true;\n    const fetchTripDataAndGeneratePlan = async () => {\n      try {\n        // First, try to get trip from localStorage\n        const localTrips = getTripsFromLocalStorage();\n        const localTrip = localTrips.find(trip => trip.id === tripId);\n        if (localTrip && isMounted) {\n          setTripInfo({\n            id: localTrip.id,\n            title: localTrip.title,\n            destination: localTrip.destination,\n            image: localTrip.image,\n            prompt: localTrip.prompt\n          });\n        }\n\n        // Try to fetch from backend API\n        try {\n          const tripResponse = await fetch(`${API_ENDPOINT}/trips/${tripId}?userId=Kartik7`);\n          if (tripResponse.ok && isMounted) {\n            const tripData = await tripResponse.json();\n            setTripInfo(prev => prev || tripData);\n          }\n        } catch (err) {\n          console.log('Could not fetch from backend, using local data');\n        }\n\n        // Fetch existing messages\n        let hasExistingMessages = false;\n        try {\n          const messagesResponse = await fetch(`${API_ENDPOINT}/trips/${tripId}/messages?userId=Kartik7`);\n          if (messagesResponse.ok) {\n            const messagesData = await messagesResponse.json();\n            if (messagesData.messages && messagesData.messages.length > 0 && isMounted) {\n              setMessages(messagesData.messages);\n              hasExistingMessages = true;\n            }\n          }\n        } catch (err) {\n          console.log('Could not fetch messages from backend');\n          // Try to load from localStorage as backup\n          try {\n            const key = `trip_chat_${tripId}`;\n            const localMessages = JSON.parse(localStorage.getItem(key) || '[]');\n            if (localMessages.length > 0 && isMounted) {\n              setMessages(localMessages);\n              hasExistingMessages = true;\n            }\n          } catch (localErr) {\n            console.log('Could not load messages from localStorage');\n          }\n        }\n\n        // If no messages exist and we have a prompt, generate the initial plan\n        if (!hasExistingMessages) {\n          const tripPrompt = localTrip === null || localTrip === void 0 ? void 0 : localTrip.prompt;\n          if (tripPrompt && isMounted) {\n            await generateInitialTravelPlan(tripPrompt);\n          }\n        }\n      } catch (error) {\n        console.error('Error fetching trip data:', error);\n        if (!isMounted) return;\n\n        // Use fallback data\n        const localTrips = getTripsFromLocalStorage();\n        const localTrip = localTrips.find(trip => trip.id === tripId);\n        if (localTrip && isMounted) {\n          setTripInfo({\n            id: localTrip.id,\n            title: localTrip.title,\n            destination: localTrip.destination,\n            image: localTrip.image,\n            prompt: localTrip.prompt\n          });\n          // Generate plan with local trip prompt\n          if (localTrip.prompt) {\n            await generateInitialTravelPlan(localTrip.prompt);\n          }\n        } else if (isMounted) {\n          setTripInfo({\n            id: tripId,\n            title: `Trip ${tripId}`,\n            destination: 'Unknown',\n            image: 'https://images.unsplash.com/photo-1488646953014-85cb44e25828?w=800&h=400&fit=crop'\n          });\n        }\n      }\n    };\n    fetchTripDataAndGeneratePlan();\n    return () => {\n      isMounted = false;\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [tripId]);\n\n  // Generate initial comprehensive travel plan using ChatGPT\n  const generateInitialTravelPlan = async prompt => {\n    setIsLoading(true);\n    const systemPrompt = `You are an expert travel planning AI assistant. Your role is to create comprehensive, personalized travel itineraries based on user requests.\n\nIMPORTANT INSTRUCTIONS:\n1. Analyze the user's travel request carefully and extract all available information\n2. Use your knowledge to fill in reasonable defaults for missing information (e.g., if no dates mentioned, suggest optimal travel times; if no budget mentioned, provide options for different budget ranges)\n3. Create a COMPLETE, DETAILED, PERSONALIZED itinerary immediately - do NOT ask questions first\n4. Include ALL of the following in your response:\n   - Pre-trip preparation (medical requirements, vaccinations, shopping list)\n   - Day-by-day itinerary with:\n     * Travel/Transportation details\n     * Hotel/Accommodation recommendations with specific names and locations\n     * Restaurant recommendations for breakfast, lunch, and dinner each day\n     * Activities and sightseeing\n     * Shopping recommendations\n     * Weather forecast and packing suggestions\n   - Post-trip recommendations\n5. Make it specific and actionable - use real place names, realistic times, and practical details\n6. Format with clear sections, bullet points, and organized structure\n7. After providing the complete plan, you can mention: \"Feel free to ask me to modify any part of this itinerary or add more details!\"`;\n    const userPrompt = `Please create a comprehensive, personalized travel plan based on this request: \"${prompt}\"\n\nProvide a complete itinerary with all details including travel, hotels, restaurants, activities, shopping, medical requirements, and weather information. Use your knowledge to fill in any missing details with reasonable assumptions.`;\n    try {\n      // Save user's initial prompt as first message\n      const initialUserMessage = {\n        id: Date.now(),\n        role: 'user',\n        content: prompt,\n        timestamp: new Date().toISOString()\n      };\n\n      // Save to backend\n      await saveMessageToBackend(initialUserMessage);\n\n      // Call ChatGPT API with timeout\n      const controller = new AbortController();\n      const timeoutId = setTimeout(() => controller.abort(), 30000); // 30 second timeout\n\n      try {\n        console.log('Sending request to:', `${API_ENDPOINT}/trips/${tripId}/chat`);\n        const requestBody = {\n          userId: 'Kartik7',\n          tripId: tripId,\n          message: userPrompt,\n          systemPrompt: systemPrompt,\n          conversationHistory: [],\n          timestamp: new Date().toISOString(),\n          isInitialPlan: true\n        };\n        console.log('Request body:', requestBody);\n        const response = await fetch(`${API_ENDPOINT}/trips/${tripId}/chat`, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify(requestBody),\n          signal: controller.signal\n        });\n        console.log('Response status:', response.status, response.statusText);\n        clearTimeout(timeoutId);\n        if (response.ok) {\n          let data;\n          try {\n            const contentType = response.headers.get('content-type');\n            if (contentType && contentType.includes('application/json')) {\n              data = await response.json();\n            } else {\n              const text = await response.text();\n              console.warn('Non-JSON response received:', text);\n              data = {\n                response: text || 'I\\'m creating your personalized travel plan...'\n              };\n            }\n          } catch (parseError) {\n            console.error('Error parsing response:', parseError);\n            throw new Error('Failed to parse API response');\n          }\n          const aiMessage = {\n            id: Date.now() + 1,\n            role: 'assistant',\n            content: data.response || data.message || data.plan || data.content || data.text || 'I\\'m creating your personalized travel plan...',\n            timestamp: new Date().toISOString()\n          };\n\n          // Save AI response to backend\n          await saveMessageToBackend(aiMessage);\n          setMessages([initialUserMessage, aiMessage]);\n        } else {\n          const errorText = await response.text().catch(() => 'Unknown error');\n          console.error('API Error Response:', {\n            status: response.status,\n            statusText: response.statusText,\n            body: errorText\n          });\n          throw new Error(`API returned status ${response.status}: ${errorText.substring(0, 100)}`);\n        }\n      } catch (fetchError) {\n        clearTimeout(timeoutId);\n        if (fetchError.name === 'AbortError') {\n          throw new Error('Request timed out. Please try again.');\n        }\n        throw fetchError;\n      }\n    } catch (error) {\n      console.error('Error generating travel plan:', error);\n      console.error('Error details:', {\n        name: error.name,\n        message: error.message,\n        stack: error.stack\n      });\n\n      // Show error message to user instead of sample plan\n      const initialUserMessage = {\n        id: Date.now(),\n        role: 'user',\n        content: prompt,\n        timestamp: new Date().toISOString()\n      };\n      let errorContent = `I apologize, but I'm having trouble connecting to the AI service right now.`;\n      if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {\n        errorContent += `\\n\\nIt looks like the backend server might not be running or there's a network issue. Please check:\\n- Is the backend server running on ${API_ENDPOINT}?\\n- Are there any CORS errors in the browser console?`;\n      } else if (error.message.includes('timeout') || error.name === 'AbortError') {\n        errorContent += `\\n\\nThe request timed out. The AI service might be slow or overloaded. Please try again.`;\n      } else {\n        errorContent += `\\n\\nError: ${error.message}`;\n      }\n      errorContent += `\\n\\nPlease try sending your message again, or refresh the page.`;\n      const errorMessage = {\n        id: Date.now() + 1,\n        role: 'assistant',\n        content: errorContent,\n        timestamp: new Date().toISOString()\n      };\n      await saveMessageToBackend(initialUserMessage).catch(() => {});\n      await saveMessageToBackend(errorMessage).catch(() => {});\n      setMessages([initialUserMessage, errorMessage]);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  // Save message to backend\n  const saveMessageToBackend = async message => {\n    try {\n      await fetch(`${API_ENDPOINT}/trips/${tripId}/messages`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          userId: 'Kartik7',\n          tripId: tripId,\n          message: message,\n          timestamp: message.timestamp\n        })\n      });\n    } catch (error) {\n      console.error('Error saving message to backend:', error);\n      // Also save to localStorage as backup\n      saveMessageToLocalStorage(message);\n    }\n  };\n\n  // Save message to localStorage as backup\n  const saveMessageToLocalStorage = message => {\n    try {\n      const key = `trip_chat_${tripId}`;\n      const existingMessages = JSON.parse(localStorage.getItem(key) || '[]');\n      existingMessages.push(message);\n      localStorage.setItem(key, JSON.stringify(existingMessages));\n    } catch (error) {\n      console.error('Error saving message to localStorage:', error);\n    }\n  };\n\n  // Auto-scroll to bottom when messages change\n  useEffect(() => {\n    var _messagesEndRef$curre;\n    (_messagesEndRef$curre = messagesEndRef.current) === null || _messagesEndRef$curre === void 0 ? void 0 : _messagesEndRef$curre.scrollIntoView({\n      behavior: 'smooth'\n    });\n  }, [messages]);\n\n  // Auto-focus input on mount\n  useEffect(() => {\n    var _inputRef$current;\n    (_inputRef$current = inputRef.current) === null || _inputRef$current === void 0 ? void 0 : _inputRef$current.focus();\n  }, []);\n  const handleSendMessage = async e => {\n    e.preventDefault();\n    if (!inputMessage.trim() || isLoading) return;\n    const userMessage = {\n      id: Date.now(),\n      role: 'user',\n      content: inputMessage.trim(),\n      timestamp: new Date().toISOString()\n    };\n\n    // Add user message immediately\n    const updatedMessages = [...messages, userMessage];\n    setMessages(updatedMessages);\n    setInputMessage('');\n    setIsLoading(true);\n\n    // Save user message to backend\n    await saveMessageToBackend(userMessage);\n    try {\n      // Prepare conversation history for ChatGPT\n      const conversationHistory = updatedMessages.map(msg => ({\n        role: msg.role,\n        content: msg.content\n      }));\n      const systemPrompt = `You are an expert travel planning AI assistant. Help users create comprehensive, personalized travel itineraries. Ask questions when you need more information. Provide detailed day-by-day plans with travel, hotels, restaurants, shopping, medical requirements, and weather forecasts.`;\n\n      // Send message to ChatGPT API with timeout\n      const controller = new AbortController();\n      const timeoutId = setTimeout(() => controller.abort(), 30000); // 30 second timeout\n\n      try {\n        console.log('Sending message to:', `${API_ENDPOINT}/trips/${tripId}/chat`);\n        const requestBody = {\n          userId: 'Kartik7',\n          tripId: tripId,\n          message: userMessage.content,\n          systemPrompt: systemPrompt,\n          conversationHistory: conversationHistory,\n          timestamp: userMessage.timestamp\n        };\n        console.log('Request body:', requestBody);\n        const response = await fetch(`${API_ENDPOINT}/trips/${tripId}/chat`, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify(requestBody),\n          signal: controller.signal\n        });\n        console.log('Response status:', response.status, response.statusText);\n        clearTimeout(timeoutId);\n        if (response.ok) {\n          let data;\n          try {\n            const contentType = response.headers.get('content-type');\n            if (contentType && contentType.includes('application/json')) {\n              data = await response.json();\n            } else {\n              const text = await response.text();\n              console.warn('Non-JSON response received:', text);\n              data = {\n                response: text || 'I received your message. How can I help you with your trip?'\n              };\n            }\n          } catch (parseError) {\n            console.error('Error parsing response:', parseError);\n            throw new Error('Failed to parse API response');\n          }\n\n          // Add AI response\n          const aiMessage = {\n            id: Date.now() + 1,\n            role: 'assistant',\n            content: data.response || data.message || data.content || data.text || data.message || 'I received your message. How can I help you with your trip?',\n            timestamp: new Date().toISOString()\n          };\n\n          // Save AI response to backend\n          await saveMessageToBackend(aiMessage);\n          setMessages(prev => [...prev, aiMessage]);\n        } else {\n          const errorText = await response.text().catch(() => 'Unknown error');\n          console.error('API Error Response:', {\n            status: response.status,\n            statusText: response.statusText,\n            body: errorText\n          });\n          throw new Error(`API returned status ${response.status}: ${errorText.substring(0, 100)}`);\n        }\n      } catch (fetchError) {\n        clearTimeout(timeoutId);\n        if (fetchError.name === 'AbortError') {\n          const timeoutMessage = {\n            id: Date.now() + 1,\n            role: 'assistant',\n            content: 'The request is taking longer than expected. Please try again, or check your connection.',\n            timestamp: new Date().toISOString()\n          };\n          await saveMessageToBackend(timeoutMessage);\n          setMessages(prev => [...prev, timeoutMessage]);\n        } else {\n          throw fetchError;\n        }\n      }\n    } catch (error) {\n      console.error('Error sending message:', error);\n      // Error response\n      const errorMessage = {\n        id: Date.now() + 1,\n        role: 'assistant',\n        content: `I apologize, but I encountered an error processing your request. Please try again. If the problem persists, the service may be temporarily unavailable.\\n\\nError: ${error.message}`,\n        timestamp: new Date().toISOString()\n      };\n      await saveMessageToBackend(errorMessage);\n      setMessages(prev => [...prev, errorMessage]);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  // Invite user to view chat\n  const handleInviteUser = async e => {\n    e.preventDefault();\n    if (!inviteEmail.trim()) return;\n    try {\n      const response = await fetch(`${API_ENDPOINT}/trips/${tripId}/invite`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          userId: 'Kartik7',\n          tripId: tripId,\n          inviteEmail: inviteEmail.trim()\n        })\n      });\n      if (response.ok) {\n        await response.json(); // Response handled, but data not needed\n        setSharedUsers(prev => [...prev, {\n          email: inviteEmail.trim(),\n          status: 'invited'\n        }]);\n        setInviteEmail('');\n        setShowInviteModal(false);\n        alert(`Invitation sent to ${inviteEmail.trim()}`);\n      } else {\n        alert('Failed to send invitation. Please try again.');\n      }\n    } catch (error) {\n      console.error('Error inviting user:', error);\n      alert('Failed to send invitation. Please try again.');\n    }\n  };\n\n  // Fetch shared users\n  useEffect(() => {\n    const fetchSharedUsers = async () => {\n      try {\n        const response = await fetch(`${API_ENDPOINT}/trips/${tripId}/shared-users?userId=Kartik7`);\n        if (response.ok) {\n          const responseData = await response.json();\n          setSharedUsers(responseData.sharedUsers || []);\n        }\n      } catch (error) {\n        console.error('Error fetching shared users:', error);\n      }\n    };\n    fetchSharedUsers();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [tripId]);\n  const handleKeyDown = e => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSendMessage(e);\n    }\n  };\n\n  // Format message content for better display (markdown-like formatting)\n  const formatMessageContent = content => {\n    if (!content) return '';\n\n    // Convert markdown-style formatting to HTML\n    let formatted = content\n    // Headers\n    .replace(/^### (.*$)/gim, '<h3>$1</h3>').replace(/^## (.*$)/gim, '<h2>$1</h2>').replace(/^# (.*$)/gim, '<h1>$1</h1>')\n    // Bold\n    .replace(/\\*\\*(.*?)\\*\\*/gim, '<strong>$1</strong>')\n    // Bullet points\n    .replace(/^â€¢ (.*$)/gim, '<li>$1</li>').replace(/^- (.*$)/gim, '<li>$1</li>')\n    // Line breaks\n    .replace(/\\n/g, '<br>');\n\n    // Wrap consecutive <li> tags in <ul>\n    formatted = formatted.replace(/(<li>.*?<\\/li>(?:<br>)?)+/g, match => {\n      return '<ul>' + match.replace(/<br>/g, '') + '</ul>';\n    });\n    return formatted;\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"trip-chat-page\",\n    children: [/*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"back-button\",\n      onClick: () => navigate('/trips'),\n      children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n        width: \"20\",\n        height: \"20\",\n        viewBox: \"0 0 24 24\",\n        fill: \"none\",\n        xmlns: \"http://www.w3.org/2000/svg\",\n        children: /*#__PURE__*/_jsxDEV(\"path\", {\n          d: \"M19 12H5M5 12L12 19M5 12L12 5\",\n          stroke: \"currentColor\",\n          strokeWidth: \"2\",\n          strokeLinecap: \"round\",\n          strokeLinejoin: \"round\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 536,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 535,\n        columnNumber: 9\n      }, this), \"Back to My Trips\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 534,\n      columnNumber: 7\n    }, this), tripInfo && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"trip-chat-header\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          display: 'flex',\n          alignItems: 'center',\n          gap: '20px',\n          flex: 1\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"trip-chat-header-image\",\n          children: /*#__PURE__*/_jsxDEV(\"img\", {\n            src: tripInfo.image,\n            alt: tripInfo.destination\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 545,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 544,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"trip-chat-header-info\",\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            children: tripInfo.title || `Trip ${tripId}`\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 548,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: tripInfo.destination || 'Unknown Destination'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 549,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 547,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 543,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"trip-chat-header-actions\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"invite-button\",\n          onClick: () => setShowInviteModal(true),\n          title: \"Invite user to view chat\",\n          children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n            width: \"18\",\n            height: \"18\",\n            viewBox: \"0 0 24 24\",\n            fill: \"none\",\n            xmlns: \"http://www.w3.org/2000/svg\",\n            children: [/*#__PURE__*/_jsxDEV(\"path\", {\n              d: \"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2\",\n              stroke: \"currentColor\",\n              strokeWidth: \"2\",\n              strokeLinecap: \"round\",\n              strokeLinejoin: \"round\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 559,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"circle\", {\n              cx: \"8.5\",\n              cy: \"7\",\n              r: \"4\",\n              stroke: \"currentColor\",\n              strokeWidth: \"2\",\n              strokeLinecap: \"round\",\n              strokeLinejoin: \"round\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 560,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"path\", {\n              d: \"M20 8v6M23 11h-6\",\n              stroke: \"currentColor\",\n              strokeWidth: \"2\",\n              strokeLinecap: \"round\",\n              strokeLinejoin: \"round\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 561,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 558,\n            columnNumber: 15\n          }, this), \"Invite\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 553,\n          columnNumber: 13\n        }, this), sharedUsers.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"shared-users\",\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"shared-users-label\",\n            children: \"Shared with:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 567,\n            columnNumber: 17\n          }, this), sharedUsers.map((user, idx) => /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"shared-user-badge\",\n            children: user.email\n          }, idx, false, {\n            fileName: _jsxFileName,\n            lineNumber: 569,\n            columnNumber: 19\n          }, this))]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 566,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 552,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 542,\n      columnNumber: 9\n    }, this), showInviteModal && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"invite-modal-overlay\",\n      onClick: () => setShowInviteModal(false),\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"invite-modal\",\n        onClick: e => e.stopPropagation(),\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"Invite User to View Chat\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 580,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n          onSubmit: handleInviteUser,\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"email\",\n            className: \"invite-email-input\",\n            placeholder: \"Enter email address\",\n            value: inviteEmail,\n            onChange: e => setInviteEmail(e.target.value),\n            required: true\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 582,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"invite-modal-actions\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"button\",\n              onClick: () => setShowInviteModal(false),\n              children: \"Cancel\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 591,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"submit\",\n              children: \"Send Invitation\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 592,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 590,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 581,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 579,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 578,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"chat-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"chat-messages\",\n        ref: messagesEndRef,\n        children: [messages.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"chat-empty-state\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"empty-state-icon\",\n            children: /*#__PURE__*/_jsxDEV(\"svg\", {\n              width: \"64\",\n              height: \"64\",\n              viewBox: \"0 0 24 24\",\n              fill: \"none\",\n              xmlns: \"http://www.w3.org/2000/svg\",\n              children: /*#__PURE__*/_jsxDEV(\"path\", {\n                d: \"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z\",\n                stroke: \"currentColor\",\n                strokeWidth: \"2\",\n                strokeLinecap: \"round\",\n                strokeLinejoin: \"round\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 605,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 604,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 603,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n            children: \"Start a conversation\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 608,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Ask questions about your trip, request changes, or get recommendations.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 609,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 602,\n          columnNumber: 13\n        }, this) : messages.map(message => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: `message ${message.role === 'user' ? 'user-message' : 'assistant-message'}`,\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"message-content\",\n            dangerouslySetInnerHTML: {\n              __html: message.role === 'assistant' ? formatMessageContent(message.content) : message.content\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 614,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"message-timestamp\",\n            children: new Date(message.timestamp).toLocaleTimeString([], {\n              hour: '2-digit',\n              minute: '2-digit'\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 618,\n            columnNumber: 17\n          }, this)]\n        }, message.id, true, {\n          fileName: _jsxFileName,\n          lineNumber: 613,\n          columnNumber: 15\n        }, this)), isLoading && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"message assistant-message\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"message-content\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"loading-container\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"loading-spinner\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 628,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"loading-text\",\n                children: \"Creating your personalized travel plan...\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 629,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"loading-subtext\",\n                children: \"This may take a few moments\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 630,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 627,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 626,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 625,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          ref: messagesEndRef\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 635,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 600,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n        className: \"chat-input-form\",\n        onSubmit: handleSendMessage,\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"chat-input-wrapper\",\n          children: [/*#__PURE__*/_jsxDEV(\"textarea\", {\n            ref: inputRef,\n            className: \"chat-input\",\n            value: inputMessage,\n            onChange: e => setInputMessage(e.target.value),\n            onKeyDown: handleKeyDown,\n            placeholder: \"Message your trip assistant...\",\n            rows: \"1\",\n            disabled: isLoading\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 640,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"submit\",\n            className: \"chat-send-button\",\n            disabled: !inputMessage.trim() || isLoading,\n            children: /*#__PURE__*/_jsxDEV(\"svg\", {\n              width: \"20\",\n              height: \"20\",\n              viewBox: \"0 0 24 24\",\n              fill: \"none\",\n              xmlns: \"http://www.w3.org/2000/svg\",\n              children: /*#__PURE__*/_jsxDEV(\"path\", {\n                d: \"M22 2L11 13M22 2L15 22L11 13M22 2L2 9L11 13\",\n                stroke: \"currentColor\",\n                strokeWidth: \"2\",\n                strokeLinecap: \"round\",\n                strokeLinejoin: \"round\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 656,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 655,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 650,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 639,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 638,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 599,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 533,\n    columnNumber: 5\n  }, this);\n};\n_s(TripChat, \"S9xnLHdfUc4MrOO9uotgc87TlFI=\", false, function () {\n  return [useParams, useNavigate];\n});\n_c = TripChat;\nexport default TripChat;\nvar _c;\n$RefreshReg$(_c, \"TripChat\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useParams","useNavigate","getTripsFromLocalStorage","jsxDEV","_jsxDEV","TripChat","_s","tripId","navigate","messages","setMessages","inputMessage","setInputMessage","isLoading","setIsLoading","tripInfo","setTripInfo","sharedUsers","setSharedUsers","showInviteModal","setShowInviteModal","inviteEmail","setInviteEmail","messagesEndRef","inputRef","API_ENDPOINT","process","env","REACT_APP_API_URL","isMounted","fetchTripDataAndGeneratePlan","localTrips","localTrip","find","trip","id","title","destination","image","prompt","tripResponse","fetch","ok","tripData","json","prev","err","console","log","hasExistingMessages","messagesResponse","messagesData","length","key","localMessages","JSON","parse","localStorage","getItem","localErr","tripPrompt","generateInitialTravelPlan","error","systemPrompt","userPrompt","initialUserMessage","Date","now","role","content","timestamp","toISOString","saveMessageToBackend","controller","AbortController","timeoutId","setTimeout","abort","requestBody","userId","message","conversationHistory","isInitialPlan","response","method","headers","body","stringify","signal","status","statusText","clearTimeout","data","contentType","get","includes","text","warn","parseError","Error","aiMessage","plan","errorText","catch","substring","fetchError","name","stack","errorContent","errorMessage","saveMessageToLocalStorage","existingMessages","push","setItem","_messagesEndRef$curre","current","scrollIntoView","behavior","_inputRef$current","focus","handleSendMessage","e","preventDefault","trim","userMessage","updatedMessages","map","msg","timeoutMessage","handleInviteUser","email","alert","fetchSharedUsers","responseData","handleKeyDown","shiftKey","formatMessageContent","formatted","replace","match","className","children","onClick","width","height","viewBox","fill","xmlns","d","stroke","strokeWidth","strokeLinecap","strokeLinejoin","fileName","_jsxFileName","lineNumber","columnNumber","style","display","alignItems","gap","flex","src","alt","cx","cy","r","user","idx","stopPropagation","onSubmit","type","placeholder","value","onChange","target","required","ref","dangerouslySetInnerHTML","__html","toLocaleTimeString","hour","minute","onKeyDown","rows","disabled","_c","$RefreshReg$"],"sources":["C:/Users/Admin/OneDrive/Desktop/Princeton/src/pages/TripChat.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport { getTripsFromLocalStorage } from '../utils/tripUtils';\r\nimport './TripChat.css';\r\n\r\nconst TripChat = () => {\r\n  const { tripId } = useParams();\r\n  const navigate = useNavigate();\r\n  const [messages, setMessages] = useState([]);\r\n  const [inputMessage, setInputMessage] = useState('');\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [tripInfo, setTripInfo] = useState(null);\r\n  const [sharedUsers, setSharedUsers] = useState([]);\r\n  const [showInviteModal, setShowInviteModal] = useState(false);\r\n  const [inviteEmail, setInviteEmail] = useState('');\r\n  const messagesEndRef = useRef(null);\r\n  const inputRef = useRef(null);\r\n\r\n  const API_ENDPOINT = process.env.REACT_APP_API_URL || 'http://localhost:8000/api/trip-planner';\r\n\r\n  // Fetch trip info and generate initial plan\r\n  useEffect(() => {\r\n    let isMounted = true;\r\n    \r\n    const fetchTripDataAndGeneratePlan = async () => {\r\n      try {\r\n        // First, try to get trip from localStorage\r\n        const localTrips = getTripsFromLocalStorage();\r\n        const localTrip = localTrips.find(trip => trip.id === tripId);\r\n        \r\n        if (localTrip && isMounted) {\r\n          setTripInfo({\r\n            id: localTrip.id,\r\n            title: localTrip.title,\r\n            destination: localTrip.destination,\r\n            image: localTrip.image,\r\n            prompt: localTrip.prompt\r\n          });\r\n        }\r\n\r\n        // Try to fetch from backend API\r\n        try {\r\n          const tripResponse = await fetch(`${API_ENDPOINT}/trips/${tripId}?userId=Kartik7`);\r\n          if (tripResponse.ok && isMounted) {\r\n            const tripData = await tripResponse.json();\r\n            setTripInfo(prev => prev || tripData);\r\n          }\r\n        } catch (err) {\r\n          console.log('Could not fetch from backend, using local data');\r\n        }\r\n\r\n        // Fetch existing messages\r\n        let hasExistingMessages = false;\r\n        try {\r\n          const messagesResponse = await fetch(`${API_ENDPOINT}/trips/${tripId}/messages?userId=Kartik7`);\r\n          if (messagesResponse.ok) {\r\n            const messagesData = await messagesResponse.json();\r\n            if (messagesData.messages && messagesData.messages.length > 0 && isMounted) {\r\n              setMessages(messagesData.messages);\r\n              hasExistingMessages = true;\r\n            }\r\n          }\r\n        } catch (err) {\r\n          console.log('Could not fetch messages from backend');\r\n          // Try to load from localStorage as backup\r\n          try {\r\n            const key = `trip_chat_${tripId}`;\r\n            const localMessages = JSON.parse(localStorage.getItem(key) || '[]');\r\n            if (localMessages.length > 0 && isMounted) {\r\n              setMessages(localMessages);\r\n              hasExistingMessages = true;\r\n            }\r\n          } catch (localErr) {\r\n            console.log('Could not load messages from localStorage');\r\n          }\r\n        }\r\n\r\n        // If no messages exist and we have a prompt, generate the initial plan\r\n        if (!hasExistingMessages) {\r\n          const tripPrompt = localTrip?.prompt;\r\n          if (tripPrompt && isMounted) {\r\n            await generateInitialTravelPlan(tripPrompt);\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error('Error fetching trip data:', error);\r\n        if (!isMounted) return;\r\n        \r\n        // Use fallback data\r\n        const localTrips = getTripsFromLocalStorage();\r\n        const localTrip = localTrips.find(trip => trip.id === tripId);\r\n        if (localTrip && isMounted) {\r\n          setTripInfo({\r\n            id: localTrip.id,\r\n            title: localTrip.title,\r\n            destination: localTrip.destination,\r\n            image: localTrip.image,\r\n            prompt: localTrip.prompt\r\n          });\r\n          // Generate plan with local trip prompt\r\n          if (localTrip.prompt) {\r\n            await generateInitialTravelPlan(localTrip.prompt);\r\n          }\r\n        } else if (isMounted) {\r\n          setTripInfo({\r\n            id: tripId,\r\n            title: `Trip ${tripId}`,\r\n            destination: 'Unknown',\r\n            image: 'https://images.unsplash.com/photo-1488646953014-85cb44e25828?w=800&h=400&fit=crop'\r\n          });\r\n        }\r\n      }\r\n    };\r\n\r\n    fetchTripDataAndGeneratePlan();\r\n    \r\n    return () => {\r\n      isMounted = false;\r\n    };\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [tripId]);\r\n\r\n  // Generate initial comprehensive travel plan using ChatGPT\r\n  const generateInitialTravelPlan = async (prompt) => {\r\n    setIsLoading(true);\r\n    \r\n    const systemPrompt = `You are an expert travel planning AI assistant. Your role is to create comprehensive, personalized travel itineraries based on user requests.\r\n\r\nIMPORTANT INSTRUCTIONS:\r\n1. Analyze the user's travel request carefully and extract all available information\r\n2. Use your knowledge to fill in reasonable defaults for missing information (e.g., if no dates mentioned, suggest optimal travel times; if no budget mentioned, provide options for different budget ranges)\r\n3. Create a COMPLETE, DETAILED, PERSONALIZED itinerary immediately - do NOT ask questions first\r\n4. Include ALL of the following in your response:\r\n   - Pre-trip preparation (medical requirements, vaccinations, shopping list)\r\n   - Day-by-day itinerary with:\r\n     * Travel/Transportation details\r\n     * Hotel/Accommodation recommendations with specific names and locations\r\n     * Restaurant recommendations for breakfast, lunch, and dinner each day\r\n     * Activities and sightseeing\r\n     * Shopping recommendations\r\n     * Weather forecast and packing suggestions\r\n   - Post-trip recommendations\r\n5. Make it specific and actionable - use real place names, realistic times, and practical details\r\n6. Format with clear sections, bullet points, and organized structure\r\n7. After providing the complete plan, you can mention: \"Feel free to ask me to modify any part of this itinerary or add more details!\"`;\r\n\r\n    const userPrompt = `Please create a comprehensive, personalized travel plan based on this request: \"${prompt}\"\r\n\r\nProvide a complete itinerary with all details including travel, hotels, restaurants, activities, shopping, medical requirements, and weather information. Use your knowledge to fill in any missing details with reasonable assumptions.`;\r\n\r\n    try {\r\n      // Save user's initial prompt as first message\r\n      const initialUserMessage = {\r\n        id: Date.now(),\r\n        role: 'user',\r\n        content: prompt,\r\n        timestamp: new Date().toISOString()\r\n      };\r\n      \r\n      // Save to backend\r\n      await saveMessageToBackend(initialUserMessage);\r\n\r\n      // Call ChatGPT API with timeout\r\n      const controller = new AbortController();\r\n      const timeoutId = setTimeout(() => controller.abort(), 30000); // 30 second timeout\r\n\r\n      try {\r\n        console.log('Sending request to:', `${API_ENDPOINT}/trips/${tripId}/chat`);\r\n        const requestBody = {\r\n          userId: 'Kartik7',\r\n          tripId: tripId,\r\n          message: userPrompt,\r\n          systemPrompt: systemPrompt,\r\n          conversationHistory: [],\r\n          timestamp: new Date().toISOString(),\r\n          isInitialPlan: true\r\n        };\r\n        console.log('Request body:', requestBody);\r\n\r\n        const response = await fetch(`${API_ENDPOINT}/trips/${tripId}/chat`, {\r\n          method: 'POST',\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n          },\r\n          body: JSON.stringify(requestBody),\r\n          signal: controller.signal\r\n        });\r\n\r\n        console.log('Response status:', response.status, response.statusText);\r\n\r\n        clearTimeout(timeoutId);\r\n\r\n        if (response.ok) {\r\n          let data;\r\n          try {\r\n            const contentType = response.headers.get('content-type');\r\n            if (contentType && contentType.includes('application/json')) {\r\n              data = await response.json();\r\n            } else {\r\n              const text = await response.text();\r\n              console.warn('Non-JSON response received:', text);\r\n              data = { response: text || 'I\\'m creating your personalized travel plan...' };\r\n            }\r\n          } catch (parseError) {\r\n            console.error('Error parsing response:', parseError);\r\n            throw new Error('Failed to parse API response');\r\n          }\r\n\r\n          const aiMessage = {\r\n            id: Date.now() + 1,\r\n            role: 'assistant',\r\n            content: data.response || data.message || data.plan || data.content || data.text || 'I\\'m creating your personalized travel plan...',\r\n            timestamp: new Date().toISOString()\r\n          };\r\n          \r\n          // Save AI response to backend\r\n          await saveMessageToBackend(aiMessage);\r\n          \r\n          setMessages([initialUserMessage, aiMessage]);\r\n        } else {\r\n          const errorText = await response.text().catch(() => 'Unknown error');\r\n          console.error('API Error Response:', {\r\n            status: response.status,\r\n            statusText: response.statusText,\r\n            body: errorText\r\n          });\r\n          throw new Error(`API returned status ${response.status}: ${errorText.substring(0, 100)}`);\r\n        }\r\n      } catch (fetchError) {\r\n        clearTimeout(timeoutId);\r\n        if (fetchError.name === 'AbortError') {\r\n          throw new Error('Request timed out. Please try again.');\r\n        }\r\n        throw fetchError;\r\n      }\r\n    } catch (error) {\r\n      console.error('Error generating travel plan:', error);\r\n      console.error('Error details:', {\r\n        name: error.name,\r\n        message: error.message,\r\n        stack: error.stack\r\n      });\r\n      \r\n      // Show error message to user instead of sample plan\r\n      const initialUserMessage = {\r\n        id: Date.now(),\r\n        role: 'user',\r\n        content: prompt,\r\n        timestamp: new Date().toISOString()\r\n      };\r\n      \r\n      let errorContent = `I apologize, but I'm having trouble connecting to the AI service right now.`;\r\n      \r\n      if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {\r\n        errorContent += `\\n\\nIt looks like the backend server might not be running or there's a network issue. Please check:\\n- Is the backend server running on ${API_ENDPOINT}?\\n- Are there any CORS errors in the browser console?`;\r\n      } else if (error.message.includes('timeout') || error.name === 'AbortError') {\r\n        errorContent += `\\n\\nThe request timed out. The AI service might be slow or overloaded. Please try again.`;\r\n      } else {\r\n        errorContent += `\\n\\nError: ${error.message}`;\r\n      }\r\n      \r\n      errorContent += `\\n\\nPlease try sending your message again, or refresh the page.`;\r\n      \r\n      const errorMessage = {\r\n        id: Date.now() + 1,\r\n        role: 'assistant',\r\n        content: errorContent,\r\n        timestamp: new Date().toISOString()\r\n      };\r\n      await saveMessageToBackend(initialUserMessage).catch(() => {});\r\n      await saveMessageToBackend(errorMessage).catch(() => {});\r\n      setMessages([initialUserMessage, errorMessage]);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  // Save message to backend\r\n  const saveMessageToBackend = async (message) => {\r\n    try {\r\n      await fetch(`${API_ENDPOINT}/trips/${tripId}/messages`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          userId: 'Kartik7',\r\n          tripId: tripId,\r\n          message: message,\r\n          timestamp: message.timestamp\r\n        })\r\n      });\r\n    } catch (error) {\r\n      console.error('Error saving message to backend:', error);\r\n      // Also save to localStorage as backup\r\n      saveMessageToLocalStorage(message);\r\n    }\r\n  };\r\n\r\n  // Save message to localStorage as backup\r\n  const saveMessageToLocalStorage = (message) => {\r\n    try {\r\n      const key = `trip_chat_${tripId}`;\r\n      const existingMessages = JSON.parse(localStorage.getItem(key) || '[]');\r\n      existingMessages.push(message);\r\n      localStorage.setItem(key, JSON.stringify(existingMessages));\r\n    } catch (error) {\r\n      console.error('Error saving message to localStorage:', error);\r\n    }\r\n  };\r\n\r\n\r\n  // Auto-scroll to bottom when messages change\r\n  useEffect(() => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n  }, [messages]);\r\n\r\n  // Auto-focus input on mount\r\n  useEffect(() => {\r\n    inputRef.current?.focus();\r\n  }, []);\r\n\r\n  const handleSendMessage = async (e) => {\r\n    e.preventDefault();\r\n    if (!inputMessage.trim() || isLoading) return;\r\n\r\n    const userMessage = {\r\n      id: Date.now(),\r\n      role: 'user',\r\n      content: inputMessage.trim(),\r\n      timestamp: new Date().toISOString()\r\n    };\r\n\r\n    // Add user message immediately\r\n    const updatedMessages = [...messages, userMessage];\r\n    setMessages(updatedMessages);\r\n    setInputMessage('');\r\n    setIsLoading(true);\r\n\r\n    // Save user message to backend\r\n    await saveMessageToBackend(userMessage);\r\n\r\n    try {\r\n      // Prepare conversation history for ChatGPT\r\n      const conversationHistory = updatedMessages.map(msg => ({\r\n        role: msg.role,\r\n        content: msg.content\r\n      }));\r\n\r\n      const systemPrompt = `You are an expert travel planning AI assistant. Help users create comprehensive, personalized travel itineraries. Ask questions when you need more information. Provide detailed day-by-day plans with travel, hotels, restaurants, shopping, medical requirements, and weather forecasts.`;\r\n\r\n      // Send message to ChatGPT API with timeout\r\n      const controller = new AbortController();\r\n      const timeoutId = setTimeout(() => controller.abort(), 30000); // 30 second timeout\r\n\r\n      try {\r\n        console.log('Sending message to:', `${API_ENDPOINT}/trips/${tripId}/chat`);\r\n        const requestBody = {\r\n          userId: 'Kartik7',\r\n          tripId: tripId,\r\n          message: userMessage.content,\r\n          systemPrompt: systemPrompt,\r\n          conversationHistory: conversationHistory,\r\n          timestamp: userMessage.timestamp\r\n        };\r\n        console.log('Request body:', requestBody);\r\n\r\n        const response = await fetch(`${API_ENDPOINT}/trips/${tripId}/chat`, {\r\n          method: 'POST',\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n          },\r\n          body: JSON.stringify(requestBody),\r\n          signal: controller.signal\r\n        });\r\n\r\n        console.log('Response status:', response.status, response.statusText);\r\n\r\n        clearTimeout(timeoutId);\r\n\r\n        if (response.ok) {\r\n          let data;\r\n          try {\r\n            const contentType = response.headers.get('content-type');\r\n            if (contentType && contentType.includes('application/json')) {\r\n              data = await response.json();\r\n            } else {\r\n              const text = await response.text();\r\n              console.warn('Non-JSON response received:', text);\r\n              data = { response: text || 'I received your message. How can I help you with your trip?' };\r\n            }\r\n          } catch (parseError) {\r\n            console.error('Error parsing response:', parseError);\r\n            throw new Error('Failed to parse API response');\r\n          }\r\n\r\n          // Add AI response\r\n          const aiMessage = {\r\n            id: Date.now() + 1,\r\n            role: 'assistant',\r\n            content: data.response || data.message || data.content || data.text || data.message || 'I received your message. How can I help you with your trip?',\r\n            timestamp: new Date().toISOString()\r\n          };\r\n          \r\n          // Save AI response to backend\r\n          await saveMessageToBackend(aiMessage);\r\n          \r\n          setMessages(prev => [...prev, aiMessage]);\r\n        } else {\r\n          const errorText = await response.text().catch(() => 'Unknown error');\r\n          console.error('API Error Response:', {\r\n            status: response.status,\r\n            statusText: response.statusText,\r\n            body: errorText\r\n          });\r\n          throw new Error(`API returned status ${response.status}: ${errorText.substring(0, 100)}`);\r\n        }\r\n      } catch (fetchError) {\r\n        clearTimeout(timeoutId);\r\n        if (fetchError.name === 'AbortError') {\r\n          const timeoutMessage = {\r\n            id: Date.now() + 1,\r\n            role: 'assistant',\r\n            content: 'The request is taking longer than expected. Please try again, or check your connection.',\r\n            timestamp: new Date().toISOString()\r\n          };\r\n          await saveMessageToBackend(timeoutMessage);\r\n          setMessages(prev => [...prev, timeoutMessage]);\r\n        } else {\r\n          throw fetchError;\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Error sending message:', error);\r\n      // Error response\r\n      const errorMessage = {\r\n        id: Date.now() + 1,\r\n        role: 'assistant',\r\n        content: `I apologize, but I encountered an error processing your request. Please try again. If the problem persists, the service may be temporarily unavailable.\\n\\nError: ${error.message}`,\r\n        timestamp: new Date().toISOString()\r\n      };\r\n      await saveMessageToBackend(errorMessage);\r\n      setMessages(prev => [...prev, errorMessage]);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  // Invite user to view chat\r\n  const handleInviteUser = async (e) => {\r\n    e.preventDefault();\r\n    if (!inviteEmail.trim()) return;\r\n\r\n    try {\r\n      const response = await fetch(`${API_ENDPOINT}/trips/${tripId}/invite`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          userId: 'Kartik7',\r\n          tripId: tripId,\r\n          inviteEmail: inviteEmail.trim()\r\n        })\r\n      });\r\n\r\n      if (response.ok) {\r\n        await response.json(); // Response handled, but data not needed\r\n        setSharedUsers(prev => [...prev, { email: inviteEmail.trim(), status: 'invited' }]);\r\n        setInviteEmail('');\r\n        setShowInviteModal(false);\r\n        alert(`Invitation sent to ${inviteEmail.trim()}`);\r\n      } else {\r\n        alert('Failed to send invitation. Please try again.');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error inviting user:', error);\r\n      alert('Failed to send invitation. Please try again.');\r\n    }\r\n  };\r\n\r\n  // Fetch shared users\r\n  useEffect(() => {\r\n    const fetchSharedUsers = async () => {\r\n      try {\r\n        const response = await fetch(`${API_ENDPOINT}/trips/${tripId}/shared-users?userId=Kartik7`);\r\n      if (response.ok) {\r\n        const responseData = await response.json();\r\n        setSharedUsers(responseData.sharedUsers || []);\r\n      }\r\n      } catch (error) {\r\n        console.error('Error fetching shared users:', error);\r\n      }\r\n    };\r\n    fetchSharedUsers();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [tripId]);\r\n\r\n  const handleKeyDown = (e) => {\r\n    if (e.key === 'Enter' && !e.shiftKey) {\r\n      e.preventDefault();\r\n      handleSendMessage(e);\r\n    }\r\n  };\r\n\r\n  // Format message content for better display (markdown-like formatting)\r\n  const formatMessageContent = (content) => {\r\n    if (!content) return '';\r\n    \r\n    // Convert markdown-style formatting to HTML\r\n    let formatted = content\r\n      // Headers\r\n      .replace(/^### (.*$)/gim, '<h3>$1</h3>')\r\n      .replace(/^## (.*$)/gim, '<h2>$1</h2>')\r\n      .replace(/^# (.*$)/gim, '<h1>$1</h1>')\r\n      // Bold\r\n      .replace(/\\*\\*(.*?)\\*\\*/gim, '<strong>$1</strong>')\r\n      // Bullet points\r\n      .replace(/^â€¢ (.*$)/gim, '<li>$1</li>')\r\n      .replace(/^- (.*$)/gim, '<li>$1</li>')\r\n      // Line breaks\r\n      .replace(/\\n/g, '<br>');\r\n    \r\n    // Wrap consecutive <li> tags in <ul>\r\n    formatted = formatted.replace(/(<li>.*?<\\/li>(?:<br>)?)+/g, (match) => {\r\n      return '<ul>' + match.replace(/<br>/g, '') + '</ul>';\r\n    });\r\n    \r\n    return formatted;\r\n  };\r\n\r\n  return (\r\n    <div className=\"trip-chat-page\">\r\n      <button className=\"back-button\" onClick={() => navigate('/trips')}>\r\n        <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n          <path d=\"M19 12H5M5 12L12 19M5 12L12 5\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\r\n        </svg>\r\n        Back to My Trips\r\n      </button>\r\n\r\n      {tripInfo && (\r\n        <div className=\"trip-chat-header\">\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: '20px', flex: 1 }}>\r\n            <div className=\"trip-chat-header-image\">\r\n              <img src={tripInfo.image} alt={tripInfo.destination} />\r\n            </div>\r\n            <div className=\"trip-chat-header-info\">\r\n              <h2>{tripInfo.title || `Trip ${tripId}`}</h2>\r\n              <p>{tripInfo.destination || 'Unknown Destination'}</p>\r\n            </div>\r\n          </div>\r\n          <div className=\"trip-chat-header-actions\">\r\n            <button \r\n              className=\"invite-button\"\r\n              onClick={() => setShowInviteModal(true)}\r\n              title=\"Invite user to view chat\"\r\n            >\r\n              <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                <path d=\"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\r\n                <circle cx=\"8.5\" cy=\"7\" r=\"4\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\r\n                <path d=\"M20 8v6M23 11h-6\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\r\n              </svg>\r\n              Invite\r\n            </button>\r\n            {sharedUsers.length > 0 && (\r\n              <div className=\"shared-users\">\r\n                <span className=\"shared-users-label\">Shared with:</span>\r\n                {sharedUsers.map((user, idx) => (\r\n                  <span key={idx} className=\"shared-user-badge\">{user.email}</span>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {showInviteModal && (\r\n        <div className=\"invite-modal-overlay\" onClick={() => setShowInviteModal(false)}>\r\n          <div className=\"invite-modal\" onClick={(e) => e.stopPropagation()}>\r\n            <h3>Invite User to View Chat</h3>\r\n            <form onSubmit={handleInviteUser}>\r\n              <input\r\n                type=\"email\"\r\n                className=\"invite-email-input\"\r\n                placeholder=\"Enter email address\"\r\n                value={inviteEmail}\r\n                onChange={(e) => setInviteEmail(e.target.value)}\r\n                required\r\n              />\r\n              <div className=\"invite-modal-actions\">\r\n                <button type=\"button\" onClick={() => setShowInviteModal(false)}>Cancel</button>\r\n                <button type=\"submit\">Send Invitation</button>\r\n              </div>\r\n            </form>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"chat-container\">\r\n        <div className=\"chat-messages\" ref={messagesEndRef}>\r\n          {messages.length === 0 ? (\r\n            <div className=\"chat-empty-state\">\r\n              <div className=\"empty-state-icon\">\r\n                <svg width=\"64\" height=\"64\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                  <path d=\"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\r\n                </svg>\r\n              </div>\r\n              <h3>Start a conversation</h3>\r\n              <p>Ask questions about your trip, request changes, or get recommendations.</p>\r\n            </div>\r\n          ) : (\r\n            messages.map((message) => (\r\n              <div key={message.id} className={`message ${message.role === 'user' ? 'user-message' : 'assistant-message'}`}>\r\n                <div \r\n                  className=\"message-content\"\r\n                  dangerouslySetInnerHTML={{ __html: message.role === 'assistant' ? formatMessageContent(message.content) : message.content }}\r\n                />\r\n                <div className=\"message-timestamp\">\r\n                  {new Date(message.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\r\n                </div>\r\n              </div>\r\n            ))\r\n          )}\r\n          {isLoading && (\r\n            <div className=\"message assistant-message\">\r\n              <div className=\"message-content\">\r\n                <div className=\"loading-container\">\r\n                  <div className=\"loading-spinner\"></div>\r\n                  <p className=\"loading-text\">Creating your personalized travel plan...</p>\r\n                  <p className=\"loading-subtext\">This may take a few moments</p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n          <div ref={messagesEndRef} />\r\n        </div>\r\n\r\n        <form className=\"chat-input-form\" onSubmit={handleSendMessage}>\r\n          <div className=\"chat-input-wrapper\">\r\n            <textarea\r\n              ref={inputRef}\r\n              className=\"chat-input\"\r\n              value={inputMessage}\r\n              onChange={(e) => setInputMessage(e.target.value)}\r\n              onKeyDown={handleKeyDown}\r\n              placeholder=\"Message your trip assistant...\"\r\n              rows=\"1\"\r\n              disabled={isLoading}\r\n            />\r\n            <button \r\n              type=\"submit\" \r\n              className=\"chat-send-button\"\r\n              disabled={!inputMessage.trim() || isLoading}\r\n            >\r\n              <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                <path d=\"M22 2L11 13M22 2L15 22L11 13M22 2L2 9L11 13\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\r\n              </svg>\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default TripChat;\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}